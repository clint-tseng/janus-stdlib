// Generated by CoffeeScript 1.11.1
(function() {
  var $, Base, DomView, Enum, EnumAttributeListEditView, List, ListView, Varying, find, from, identity, mutators, ref, template,
    extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  ref = require('janus'), Varying = ref.Varying, DomView = ref.DomView, from = ref.from, template = ref.template, find = ref.find, mutators = ref.mutators, Base = ref.Base, List = ref.List;

  Enum = require('janus').attribute.Enum;

  identity = require('janus').util.identity;

  ListView = require('./list').ListView;

  $ = require('janus-dollar');

  EnumAttributeListEditView = (function(superClass) {
    extend(EnumAttributeListEditView, superClass);

    function EnumAttributeListEditView() {
      return EnumAttributeListEditView.__super__.constructor.apply(this, arguments);
    }

    EnumAttributeListEditView.prototype._wireEvents = function() {
      var checkedClass, dom, list, listView, ref1;
      attr = this.subject;
      dom = this.artifact();
      dom.on('click', '> .janus-list > *', (function(_this) {
        return function(event) {
          if (event.isDefaultPrevented() === true) {
            return;
          }
          return _this.subject.setValue($(event.currentTarget).data('view').subject);
        };
      })(this));
      list = dom.children(':first');
      listView = this.into_(ListView);
      checkedClass = (ref1 = this.options.checkedClass) != null ? ref1 : 'checked';
      this.reactTo(Varying.all([attr.values(), attr.getValue()]), (function(_this) {
        return function(values, selected) {
          var binding, i, idx, len, ref2;
          list.children().removeClass(checkedClass);
          ref2 = listView._mappedBindings.list;
          for (idx = i = 0, len = ref2.length; i < len; idx = ++i) {
            binding = ref2[idx];
            if (values.get_(idx) === selected) {
              binding.dom.addClass(checkedClass);
            }
          }
        };
      })(this));
    };

    return EnumAttributeListEditView;

  })(DomView.build($('<div class="janus-enum-select"/>'), find('div').render(from.subject().flatMap(function(attr) {
    return attr.values();
  })).options(from.self().map(function(view) {
    return view.options;
  }))));

  module.exports = {
    EnumAttributeListEditView: EnumAttributeListEditView,
    registerWith: function(library) {
      return library.register(Enum, EnumAttributeListEditView, {
        context: 'edit',
        style: 'list'
      });
    }
  };

}).call(this);
